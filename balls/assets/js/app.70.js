if(window.location!==window.top.location||window.location.href&&!window.location.href.match(/bouncyballs\.org|192\.168/)){top.location.href="https://bouncyballs.org/"}(function(e,t,i,n,a,o,s){e["GoogleAnalyticsObject"]=a;e[a]=e[a]||function(){(e[a].q=e[a].q||[]).push(arguments)},e[a].l=1*new Date;o=t.createElement(i),s=t.getElementsByTagName(i)[0];o.async=1;o.src=n;s.parentNode.insertBefore(o,s)})(window,document,"script","https://www.google-analytics.com/analytics.js","ga");(function(){var e="UA-56095-13",t="ga:clientId";if(window.localStorage){ga("create",e,"auto",{storage:"none",clientId:localStorage.getItem(t)});ga(function(e){localStorage.setItem(t,e.get("clientId"))})}else{ga("create",e,"auto")}ga("set","anonymizeIp",true);ga("send","pageview")})();function trackEvent(e,t,i,n){if(window.location.href.match(/neave\.local|192\.168/)){console.log("Event",e,t,i,n)}else{ga("send","event",e,t,i,n)}}(function(){"use strict";window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(e){return setTimeout(e,1e3/60)};window.cancelAnimationFrame=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.msCancelAnimationFrame||function(e){clearTimeout(e)};window.on=window.addEventListener;window.off=window.removeEventListener;window.AudioContext=window.AudioContext||window.webkitAudioContext;navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia;try{if(window.orientation!==0){window.orientation=0}}catch(e){}try{var T=document.querySelector.bind(document),a=document.querySelectorAll.bind(document),e=document.addEventListener.bind(document);Element.prototype.get=Element.prototype.querySelector;Element.prototype.getAll=Element.prototype.querySelectorAll;Element.prototype.on=Element.prototype.addEventListener;Element.prototype.off=Element.prototype.removeEventListener;Element.prototype.onScope=function(t,e,i,n){this.on(e,function(e){i.call(t,e)},n===undefined?false:n)};Element.prototype.show=function(){this.style.display="block"};Element.prototype.hide=function(){this.style.display="none"}}catch(e){}var L=false;try{var t=Object.defineProperty({},"passive",{get:function(){L=true}});window.on("_",null,t);window.off("_",null,t)}catch(e){}Math.clamp=function(e,t,i){return Math.max(t,Math.min(e,i))};Array.prototype.shuffle=function(){var e,t;for(var i=this.length-1;i>0;i--){e=Math.floor(Math.random()*(i+1));t=this[i];this[i]=this[e];this[e]=t}return this};function A(e){e.preventDefault()}function s(e){e.stopImmediatePropagation()}function P(e){var t=new Image;t.src="/assets/images/"+e}var F=function(){var i={gravity:0},e=false,n={x:0,y:0},t;function a(){D.fitBalls();U.width=window.innerWidth;var e=T(".stage");if(e){U.height=parseFloat(window.getComputedStyle(e).getPropertyValue("height"))||window.innerHeight}else{U.height=window.innerHeight}window.scrollTo(0,0);D.fitBalls()}function o(e){if(document.hidden||document.webkitHidden||document.mozHidden){D.pause()}else if(U.isEnabled()){a();D.play()}}function s(e){if(e&&e.acceleration&&e.acceleration.x!==undefined&&e.acceleration.y!==undefined){n.x=e.acceleration.x/2;n.y=e.acceleration.y/2}}i.enableAwake=function(){if(t){var e=t.play();if(e){e.catch(function(){trackEvent("Error","Unable to play awake video")})}}};i.disableAwake=function(){if(t){t.pause()}};i.getForces=function(){var e,t;switch((window.orientation+360)%360){case 90:e=-n.y;t=i.gravity-n.x;break;case 180:e=-n.x;t=i.gravity+n.y;break;case 270:e=n.y;t=i.gravity+n.x;break;default:e=n.x;t=i.gravity-n.y}return{x:e,y:t}};function r(){var e=document.createElement("p"),t,i={webkitTransform:"-webkit-transform",transform:"transform"};document.body.insertBefore(e,null);for(var n in i){if(e.style[n]!==undefined){e.style[n]="translate3d(1px,1px,1px)";t=window.getComputedStyle(e).getPropertyValue(i[n])}}document.body.removeChild(e);return t!==undefined&&t.length>0&&t!=="none"}i.init=function(){if(e||!document.body.classList||!r()){return false}e=true;if(navigator.standalone!==undefined){document.body.classList.add("mobile")}i.isMobile=document.body.classList.contains("mobile");if(i.isMobile){t=T(".awake");if(t){t.addEventListener("timeupdate",function(e){if(t.currentTime>1.5){t.currentTime=0}})}window.on("devicemotion",s,false)}window.on("webkitvisibilitychange",o,false);window.on("orientationchange",function(){setTimeout(a,250)},false);window.on("resize",a,false);a();return true};return i}();var U=function(){var a={},e=false,t=false,i;function n(){this.x=0;this.y=0;this.dx=0;this.dy=0;this.offsetX=0;this.offsetY=0;this.down=false;this.size=0}n.prototype.move=function(e,t){this.dx=e-this.x;this.dy=t-this.y;this.x=e;this.y=t};n.prototype.offset=function(e,t,i,n){this.x=e;this.y=t;this.offsetX=i;this.offsetY=n};n.prototype.updateSize=function(){this.size=F.isMobile||a.getSquareSize()<600?50:120};a.pointers={mouse:new n};a.addPointer=function(e){var t=new n;a.pointers[e]=t;return t};function o(e){a.pointers.mouse.down=true;a.pointers.mouse.updateSize();D.bounceBalls(120);A(e)}function s(e){if(e.touches){for(var t=e.touches.length;t--;){var i=e.touches[t];if(!a.pointers[i.identifier]){var n=a.addPointer(i.identifier);n.down=true;n.updateSize();n.move(i.clientX,i.clientY)}}}A(e)}function r(e){a.pointers.mouse.move(e.clientX,e.clientY)}function l(e){if(e.changedTouches){for(var t=e.changedTouches.length;t--;){var i=e.changedTouches[t],n=a.pointers[i.identifier];if(n){n.move(i.clientX,i.clientY)}}}}function c(e){if(e.changedTouches){for(var t=e.changedTouches.length;t--;){var i=e.changedTouches[t].identifier;D.releaseBall(i);delete a.pointers[i]}}a.pointers.mouse.down=false;D.releaseBall("mouse")}a.width=0;a.height=0;a.error=false;a.getSquareSize=function(){return Math.sqrt(a.width*a.height)};a.swapMode=function(e,t){if(i){i.classList.remove(t);i.classList.add(e)}};a.add=function(e){if(i){i.appendChild(e)}};a.enable=function(){if(i){i.classList.add("grab");t=true}};a.isEnabled=function(){return t};a.hide=function(){if(T){T(".stage").style.display="none"}};a.init=function(){if(e){return}e=true;i=T(".stage");if(i){i.on("mousedown",o,false);i.on("mousemove",r,false);i.on("mouseup",c,false);i.on("mouseleave",c,false);i.on("contextmenu",A,false);i.on("touchstart",s,L?{passive:false}:false);i.on("touchmove",l,L?{passive:true}:false);i.on("touchend",c,L?{passive:true}:false);i.on("touchcancel",c,L?{passive:true}:false)}};return a}();var z=function(){var t=["white","purple","yellow","pink","green","red","orange","blue","cyan","black"],i=["blue","green","brown","gray","pink","purple","yellow"];function e(e,t,i,n,a,o){this.x=e;this.y=t;this.px=i;this.py=n;this.radius=a;this.overlap=0;this.id=o;this.angle=0;this.el=null;this.pointerID=null;this.isDragged=false;this.canPop=false;this.canRoll=false}function n(e){if(e){if(this.canPop){D.popBubble(this)}else{var t=e.clientX||0,i=e.clientY||0,n=U.pointers.mouse;this.isDragged=true;this.pointerID="mouse";n.offset(t,i,t-this.x,i-this.y)}A(e);s(e)}}function a(e){if(e){if(this.canPop){D.popBubble(this)}else if(e.touches){for(var t=e.touches.length;t--;){var i=e.touches[t];if(i.target===this.el&&!U.pointers[i.identifier]){var n=i.clientX||0,a=i.clientY||0,o=U.addPointer(i.identifier);this.isDragged=true;this.pointerID=i.identifier;o.offset(n,a,n-this.x,a-this.y);break}}}A(e);s(e)}}function o(e){var t=document.createElement("div");t.onScope(e,"mousedown",n);t.onScope(e,"touchstart",a,L?{passive:false}:false);return t}e.prototype.setRadius=function(e){this.radius=e;var t=e+this.overlap;this.el.style.width=this.el.style.height=t*2+"px";this.el.style.left=this.el.style.top=-t+"px"};e.prototype.setMode=function(e){this.el=this.el||o(this);this.el.innerHTML="";this.el.style.backgroundPosition="";this.el.className="ball";this.canRoll=false;this.isDragged=false;this.canPop=false;this.angle=0;this.overlap=0;switch(e){case D.MODES.PLASTIC:this.el.classList.add(t[this.id%t.length]);break;case D.MODES.EMOJI:this.el.style.backgroundPosition=this.id%6*20+"% "+Math.floor(this.id/6)%6*20+"%";this.canRoll=true;this.angle=Math.random()*360;this.overlap=Math.round(this.radius/10);break;case D.MODES.BUBBLES:this.canPop=true;break;case D.MODES.EYES:this.el.innerHTML='<div class="outer-iris"><div class="iris"></div></div>';this.el.classList.add(i[this.id%i.length]);this.canRoll=true;this.angle=Math.random()*360;break}this.setRadius(this.radius);this.move()};e.prototype.force=function(e,t){this.x+=e;this.y+=t;if(this.canRoll){this.angle+=(this.x-this.px)/this.radius*36}var i=this.x*2-this.px;var n=this.y*2-this.py;this.px=this.x;this.py=this.y;this.x=i;this.y=n};e.prototype.release=function(){var e=U.pointers[this.pointerID];if(e&&this.isDragged){this.isDragged=false;this.px=this.x-e.dx*.3;this.py=this.y-e.dy*.3;this.pointerID=null}};e.prototype.move=function(e){var t="translate3d("+this.x+"px,"+this.y+"px,0)";if(!this.canRoll){this.angle=e}if(this.angle){t+="rotateZ("+this.angle+"deg)"}this.el.style.webkitTransform=this.el.style.transform=t};return e}();var R=function(){var e={},t=false,i;function n(){i[1].className="bg";i[1].hide()}e.show=function(e,t){i[0].classList.add(e);i[1].classList.add("fade");i[1].style.opacity=0;if(!t){n()}};e.swap=function(e){i[1].show();i[1].classList.add(e);i[1].style.opacity=1;i[0].classList.remove(e)};e.init=function(){if(t){return}t=true;i=a(".bg");i[1].on("transitionend",n,false)};return e}();var D=function(){var s={},i=false,r=true,t,l,c,d=[],f={min:0,max:0},a=1,u=1,o=1,n=0,h=0,m=0,p=0,v=25,y=250,g=.8,w=3;s.MODES={PLASTIC:"plastic",EMOJI:"emoji",BUBBLES:"bubbles",EYES:"eyes"};try{if(window.localStorage){o=parseFloat(localStorage.getItem("elasticity")||1)}}catch(e){}function b(e,t){if(!e||!s.MODES[e.toUpperCase()]){e=s.MODES.PLASTIC}U.swapMode(e,l);R.show(e,t);l=e;try{if(window.localStorage){localStorage.setItem("mode",l)}}catch(e){}B(t);r=true;V.enable();V.setMode(e)}function M(e){u=isNaN(e)?1:e;a=Math.pow(u/w,2)}s.swapMode=function(e){if(l&&r){N();s.bounceBalls(20*F.gravity);c=e;p=0;r=false;R.swap(l)}else{b(e,false)}};function x(){for(var e=m;e--;){var t=d[e],i,n,a,o,s;for(var r in U.pointers){s=U.pointers[r];if(s.down){i=t.x-s.x;n=t.y-s.y;a=Math.sqrt(i*i+n*n);if(a>0){o=a-t.radius-s.size;if(o<0){t.x-=i*o/a/2;t.y-=n*o/a/2}}else{t.x+=Math.random();t.y-=Math.random()}}}for(var l=m;l--;){if(l!==e){var c=d[l];i=t.x-c.x;n=t.y-c.y;a=Math.sqrt(i*i+n*n);if(a>0){o=a-t.radius-c.radius;if(o<0){var f=i*o/a/2;var u=n*o/a/2;t.x-=f;t.y-=u;c.x+=f;c.y+=u}}else{t.x+=Math.random();t.y-=Math.random()}}}}}function E(){var e=F.gravity<0,t=0;for(var i=m;i--;){var n=d[i];if(n&&!n.isDragged){var a=n.px-n.x,o=n.py-n.y;if(n.x<n.radius){n.x=n.radius;n.px=n.x-a*g}else if(n.x>U.width-n.radius){n.x=U.width-n.radius;n.px=n.x-a*g}if(e&&n.y<n.radius){if(r){n.y=n.radius;n.py=n.y-o*g}else if(n.y<n.radius*-2){t++}}else if(n.y<U.height*-2-n.radius){n.y=U.height*-2-n.radius;n.py=n.y-o*g}else if(!e&&n.y>U.height-n.radius){if(r){n.y=U.height-n.radius;n.py=n.y-o*g}else if(n.y>U.height+n.radius*2){t++}}else if(n.y>U.height*3-n.radius){n.y=U.height*3-n.radius}}}if(!r&&t>m-1){b(c,true)}}function S(e,t,i){for(var n=m;n--;){var a=d[n];if(a){var o=a.x-e,s=a.y-t,r=Math.sqrt(o*o+s*s);if(r<a.radius+i){return true}}}return false}function k(){for(var e=y;e--;){var t=new z(-200,-200,-200,-200,50,d.length);t.setMode(l);d.push(t);U.add(t.el)}}function T(e){var t=d[e];if(t){t.x=t.y=t.px=t.py=-200;t.setRadius(50);t.move()}}function L(e,t,i){var n=50;while(n){var a=Math.random()*(U.width-t*2)+t,o=Math.random()*(U.height*(i?2:1)-t*2)+t;if(i){o+=U.height*(F.gravity<0?1:-2)}if(S(a,o,t)||H.hitTest(a,o,t)){n--}else{var s=d[e];if(s){s.x=a;s.y=o;s.px=a+(Math.random()-.5)*2*u;s.py=o+(Math.random()-.5)*u;s.setRadius(t);s.setMode(l)}return true}}return false}function A(e){return Math.ceil(Math.clamp(e,v,D()))}function D(){var e=1;switch(l){case s.MODES.PLASTIC:e=140;break;case s.MODES.EMOJI:e=120;break;case s.MODES.BUBBLES:e=140;break;case s.MODES.EYES:e=170;break}return Math.clamp(Math.ceil(U.getSquareSize()/e)*25-v,v*2,y)}function B(e){if(p){m=A(p)}var t=Math.ceil(U.getSquareSize()),i=3,n=0,a;switch(l){case s.MODES.PLASTIC:if(!p){m=A(t/12)}f.min=t<600?6:4;f.max=Math.clamp(m/1.2,45,80);F.gravity=2;break;case s.MODES.EMOJI:if(!p){m=A(t<800?36:t/16)}f.min=f.max=t<800?22:28;F.gravity=1.5;break;case s.MODES.BUBBLES:if(!p){m=A(t/12)}f.min=4;f.max=Math.clamp(m/1.1,60,100);F.gravity=-1.5;i=4;break;case s.MODES.EYES:if(!p){m=A(t/14)}f.min=15;f.max=Math.clamp(m/1.3,35,80);F.gravity=2;i=2;break}for(a=y;a--;){T(a)}for(a=y;a--;){if(a<m){var o=Math.pow(a,i)/(Math.pow(m,i)/(f.max-f.min))+f.min;if(L(n,o,e)){n++}else{m--}}}V.setTotal(m,D())}s.setTotal=function(e){s.swapMode(l);p=e};s.setElasticity=function(e){o=Math.clamp(e,.1,2)};function C(){var e=F.getForces();for(var t=m;t--;){var i=d[t];if(i){var n=U.pointers[i.pointerID];if(i.isDragged&&n){i.x=n.x-n.offsetX;i.y=n.y-n.offsetY}else{i.force(e.x*a,e.y*a)}}}}function I(){for(var e=m;e--;){var t=d[e];if(t){t.move()}}}s.bounceBalls=function(e){if(!e||!r){return}e=Math.abs(e)/u*a*o;for(var t=m;t--;){var i=d[t];if(i){if(F.gravity<0&&i.y<i.radius*2){i.force(0,e+Math.random())}else if(i.y>U.height-i.radius*2){i.force(0,-e-Math.random())}}}};s.fitBalls=function(){if(!U.error&&U.width&&U.height){var e=window.innerHeight-U.height||0,t=window.innerWidth-U.width||0,i;for(var n=m;n--;){i=d[n];if(i){if(U.isEnabled()){if(t<0||e<0){i.x+=t;i.y+=e}}else{i.x+=t/2;i.y+=e/2}}}for(n=w;n--;){x();E()}for(n=m;n--;){i=d[n];if(i){i.px=i.x;i.py=i.y}}I();V.setTotal(m,D());V.setElasticity(o)}};s.releaseBall=function(e){for(var t=m;t--;){var i=d[t];if(i&&i.pointerID===e){i.release();return}}};function N(){for(var e=m;e--;){var t=d[e];if(t){t.release()}}}s.popBubble=function(e){if(l===s.MODES.BUBBLES){L(e.id,e.radius,true);e.py=e.y-Math.random()*20}};function O(){if(window.performance&&performance.now){return performance.now()}if(Date.now){return Date.now()}return(new Date).getTime()}function q(){h+=(1e3/(O()-n)-h)/4;if(isNaN(h)){h=60}n=O();M(60/Math.clamp(h,30,F.isMobile?120:60));if(Y.volume>0){s.bounceBalls(Math.sqrt(Y.volume*Y.volume));if(Y.volume*o>99){V.showNoiseAlert()}}for(var e=w;e--;){C();x();E()}I();t=requestAnimationFrame(q)}s.pause=function(){cancelAnimationFrame(t)};s.play=function(){if(U.error){return}U.enable();cancelAnimationFrame(t);h=60;q()};s.init=function(e){if(i){return}i=true;M(u);V.setElasticity(o);R.init();k();b(e,false);var t=window.devicePixelRatio>=1.3;P("emoji-new"+(t?"-2x":"")+".png");P("underwater.jpg")};return s}();var Y=function(){var i={},n=false,t=false,a,o,s,r,l,c,f,u=4;function d(){if(!n){return}if(r){r.getByteFrequencyData(c)}var e=0;for(var t=c.length;t--;){e+=c[t]}i.volume=e/c.length*(F.isMobile?2:1)}function e(e){if(!window.AudioContext||!f){return}a=e;if(a&&a.getAudioTracks){var t=a.getAudioTracks();if(t.length>0){o=t[0];if(o&&o.addEventListener){o.addEventListener("ended",h,false)}}else{return}}else{return}r=f.createAnalyser();r.fftSize=1024;r.smoothingTimeConstant=.3;c=new Uint8Array(r.frequencyBinCount);l=f.createScriptProcessor(1024,1,1);if(l&&l.addEventListener){l.addEventListener("audioprocess",d,false);l.connect(f.destination)}else{return}s=f.createMediaStreamSource(a);s.connect(r);if(u>0){u--}n=true;V.useMic(true)}function h(e){if(e){switch(e.name){case"DevicesNotFoundError":case"NO_DEVICES_FOUND":case"NotFoundError":case"NotFoundError: The object can not be found here.":i.help();break}}if(s){s.disconnect(0)}if(l){if(l.removeEventListener){l.removeEventListener("audioprocess",d)}l.disconnect(0)}t=n=false;V.useMic(false);i.volume=0;F.disableAwake()}i.volume=0;function m(){return window.Promise&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia}i.isOn=function(){return n};i.isCapable=function(){return!!navigator.getUserMedia||m()};i.help=function(){var e=T(".item.mic");if(window.alert&&e&&e.dataset&&e.dataset.error){alert(e.dataset.error)}};i.toggle=function(){if(!f){f=new AudioContext}if(i.isCapable()&&!n&&!t){t=true;if(f&&f.resume){f.resume()}if(F.isMobile||u>0){F.enableAwake();if(m()){navigator.mediaDevices.getUserMedia({video:false,audio:true}).then(e).catch(h)}else{navigator.getUserMedia({video:false,audio:true},e,h)}}else{n=true;V.useMic(true)}}else if(o){if(F.isMobile||u>0){F.disableAwake();if(o.stop){o.stop()}else if(a&&a.stop){a.stop()}h()}else{t=n=false;V.useMic(false);i.volume=0}}};return i}();var B=function(){var e={},a={},n=["beep","shush1","shush2"],i;function t(e){var t=new window.Audio,i="/assets/audio/"+e,n=document.createElement("source");n.type="audio/mpeg";n.src=i+".mp3";t.appendChild(n);n=document.createElement("source");n.type="audio/ogg";n.src=i+".ogg";t.appendChild(n);a[e]=t}e.playTrack=function(t,e){if(!!window.Audio){clearTimeout(i);i=setTimeout(function(){if(a[t]){a[t].muted=false;var e=a[t].play();if(e){e.catch(function(){})}}},e||0)}};e.prepareTracks=function(){if(!!window.Audio){for(var e=0;e<n.length;e++){var t=n[e];if(a[t]){a[t].muted=true;var i=a[t].play();if(i){i.catch(function(){})}}}}};e.init=function(){if(!!window.Audio){for(var e=0;e<n.length;e++){t(n[e])}}};return e}();var H=function(){var e={},n=false,a,o,s,r;function t(){o.parentNode.removeChild(o)}function l(e){if(e&&e.propertyName==="top"){s.off("transitionend",l);t()}}function c(e){A(e);document.title="Bouncy Balls";r.off("click",c);r.off("touchstart",A,L?{passive:false}:false);r.off("touchend",c,L?{passive:false}:false);s.classList.remove("fade-in");s.classList.add("drop");if(o.classList.contains("bubbles")){s.style.top="-50%"}else{s.style.top="125%"}s.style.opacity=0;s.on("transitionend",l,false);r.parentNode.removeChild(r);a.parentNode.removeChild(a);var t=T(".intro-main .privacy");if(t&&t.parentNode){t.parentNode.removeChild(t)}var i=T(".neave");if(i&&i.parentNode){i.parentNode.removeChild(i)}var n=T(".link-twitter");if(n&&n.parentNode){n.parentNode.removeChild(n)}if(F.isMobile){B.prepareTracks()}setTimeout(function(){V.fadeIn(250);V.show(500);window.scrollTo(0,0);D.fitBalls();D.play()},30)}e.hitTest=function(e,t){if(U.isEnabled()||U.width<601||U.height<481){return false}var i=U.width/2,n=U.height/2,a=380,o=190;if(e>i-a&&e<i+a&&t>n-o&&t<n+o){return true}return false};e.error=function(){U.hide();trackEvent("Error","Could not init");if(!document.querySelector){return}document.querySelector(".intro-text").style.display="none";var e=document.querySelector(".intro-text.error");if(e){e.style.display="block";if(e.classList){e.classList.add("fade");setTimeout(function(){e.style.opacity=1},20)}else{e.style.opacity=1}}};e.init=function(e){if(n){return}n=true;o=T(".intro-main");o.style.opacity=0;o.show();o.classList.add("fade",e);a=T(".intro-text");a.classList.add("fade");setTimeout(function(){a.style.opacity=1;o.style.opacity=1},20);s=o.get("h1");s.on("touchstart",A,L?{passive:false}:false);var t=T(".intro-text.noscript");if(t&&t.parentNode){t.parentNode.removeChild(t)}var i=T(".intro-text.error");if(i&&i.parentNode){i.parentNode.removeChild(i)}r=o.get(".button");r.on("click",c,false);r.on("touchstart",A,L?{passive:false}:false);r.on("touchend",c,L?{passive:false}:false)};return e}();var V=function(){var i={},f=false,u,d,h,m=new e(0,2),p=new e(25,250),v,n=0,y,a,g,w="",o;function e(e,t){this.pressed=false;this.thumbWidth=16;this.min=e;this.max=t}e.prototype.initUI=function(e,t,i){if(e){this.bar=e;this.thumb=e.get(".thumb")}if(t){this.title=t;this.text=t.innerHTML}var n=this;function a(e){e.preventDefault();if(!d.disabled){n.pressed=true;s(n,e)}}e.on("mousedown",a,false);e.on("touchstart",a,L?{passive:false}:false)};e.prototype.getThumbMax=function(){if(!this.bar){return}var e=120,t=this.bar.getBoundingClientRect();if(t&&t.width){e=t.width}return e-this.thumbWidth};e.prototype.setThumb=function(e){if(this.thumb&&!isNaN(e)){this.thumb.style.webkitTransform=this.thumb.style.transform="translate3d("+Math.clamp(Math.round(e),0,this.getThumbMax())+"px,0,0)"}};e.prototype.setThumbByValue=function(e){if(!isNaN(e)){this.setThumb((e-this.min)/(this.max-this.min)*this.getThumbMax())}};e.prototype.setValue=function(e){this.value=Math.clamp(e,this.min,this.max);if(this.title&&!isNaN(this.value)){if(this===m){this.title.innerHTML=this.pressed?Math.round(this.value*100)+"%":this.text}else{this.title.innerHTML=this.pressed?Math.round(this.value):this.text}}};function s(e,t){if(e.pressed&&e.bar){var i=e.bar.getBoundingClientRect();if(i&&i.left){var n;if(t.touches){if(t.touches.length===1){n=t.touches[0].clientX}else{return}}else{n=t.clientX}n=n-i.left-e.thumbWidth/2;e.setThumb(n);e.setValue(n/e.getThumbMax()*(e.max-e.min)+e.min)}}if(e===m&&e.pressed){D.setElasticity(m.value)}A(t)}function b(e){s(m,e);s(p,e)}function M(e){if(p.pressed){p.pressed=false;D.setTotal(p.value);i.disable()}if(m.pressed){m.pressed=false;var t=m.value;D.setElasticity(t);i.setElasticity(t);try{if(window.localStorage){localStorage.setItem("elasticity",Math.round(t*100)/100)}}catch(e){}}}function x(e){A(e);D.swapMode(e.target.id||e.target.getAttribute("for"));i.disable()}function E(e){A(e);w=e.target.id||e.target.getAttribute("for");var t=T('.item.noise .list input[id="'+w+'"]');if(t){t.checked=true}try{if(window.localStorage){localStorage.setItem("sound",w)}}catch(e){}}i.setElasticity=function(e){if(e<m.min){return}m.setValue(e);m.setThumbByValue(e);trackEvent("Elasticity",Math.round(e*100))};i.setTotal=function(e,t){if(e<p.min){return}p.max=t;p.setValue(Math.round(e));p.setThumbByValue(e);trackEvent("Total",e)};i.setMode=function(e){var t=T('.item.mode input[id="'+e+'"]');if(t){t.checked=true}trackEvent("Mode",e)};function S(e){if(g){if(!g.checked){clearTimeout(a);v.style.opacity=0}try{if(window.localStorage){localStorage.setItem("alert",g.checked)}}catch(e){}var t=T(".item.noise .list");if(t){clearTimeout(o);t.show();if(g.checked){o=setTimeout(function(){t.style.opacity=1},0)}else{t.style.opacity=0;o=setTimeout(function(){t.hide()},160)}}}trackEvent("Noise Alert",g.checked?"on":"off")}i.useMic=function(e){if(h){if(e){h.classList.remove("off");h.classList.add("on")}else{h.classList.remove("on");h.classList.add("off")}}trackEvent("Microphone",e?"on":"off")};i.enable=function(){if(d){d.disabled=false}};i.disable=function(){if(d){d.disabled=true}};function k(){var e=y.length;for(var t=e;t--;){y[t].hide()}n++;if(n>=e){n=0;y.shuffle()}trackEvent("Noise Alert","shown")}i.showNoiseAlert=function(){if(v&&g&&g.checked){if(/beep|shush/.test(w)&&v.style.opacity<1){var e=w;if(w==="shush"){e+=Math.random()<.5?1:2}B.playTrack(e,200);trackEvent("Noise Sound","played",e)}y[n].show();v.style.opacity=1;clearTimeout(a);a=setTimeout(function(){v.style.opacity=0;a=setTimeout(k,700)},2e3)}};i.fadeIn=function(e){if(u){u.style.opacity=0;u.show();u.classList.add("fade");setTimeout(function(){u.style.opacity=1},e||20)}};i.show=function(e){if(u){setTimeout(function(){u.classList.remove("hidden");u.classList.add("visible")},e||20)}};i.init=function(){if(f){return}f=true;u=T(".menu");d=u.get(".menu fieldset");d.on("touchmove",A,L?{passive:false}:false);h=T(".item.mic .icon");if(Y.isCapable()){P("microphone-on.svg");h.on("click",Y.toggle,false)}else{h.on("click",Y.help,false)}var e=u.get(".item.elasticity");m.initUI(e.get(".range"),e.get("h2"));var t=u.get(".item.total");p.initUI(t.get(".range"),t.get("h2"));u.on("mousemove",b,false);u.on("touchmove",b,L?{passive:true}:false);document.body.on("mouseup",M,false);document.body.on("mouseleave",M,false);document.body.on("touchend",M,L?{passive:true}:false);var i=u.getAll(".item.mode input"),n=u.getAll(".item.mode label");for(var a=i.length;a--;){i[a].on("change",x,false);n[a].on("touchstart",x,L?{passive:false}:false)}v=T(".noise-alert");var o=v.getAll("h3");if(o){y=[].slice.call(o)}else{y=[]}g=T("#noise");g.on("click",S,false);k();var s=F.isMobile?"none":"shush";try{if(window.localStorage){g.checked=localStorage.getItem("alert")!=="false";s=localStorage.getItem("sound")||s;S()}}catch(e){}var r=u.getAll(".item.noise .list input"),l=u.getAll(".item.noise .list label");for(var a=r.length;a--;){var c=r[a];c.on("change",E,false);if(c.id===s){c.checked=true;w=s}l[a].on("touchstart",E,L?{passive:false}:false)}};return i}();if(e){e("error",function(e){e.preventDefault();trackEvent("Error",e.error&&e.error.stack||e.message,e.filename?"["+e.filename+(e.lineno?":"+e.lineno:"")+(e.colno?":"+e.colno:"")+"]":"")})}var i=D.MODES.PLASTIC;try{if(window.localStorage){i=localStorage.getItem("mode")||D.MODES.PLASTIC}}catch(e){}function n(){if(F.init()){U.init();V.init();B.init();D.init(i);return true}else{H.error();return false}}if(e){e("DOMContentLoaded",function(e){if(window.innerWidth){if(n()){window.onload=function(e){H.init(i)}}}else{setTimeout(function(){if(n()){H.init(i)}},200)}})}else{H.error()}})();
